#!/usr/bin/env bash

declare uid audio_gid dbus_path

uid="$(id -u)"
audio_gid="$(getent group audio | cut -d: -f3)"
dbus_path="$(echo "$DBUS_SESSION_BUS_ADDRESS" | cut -d= -f2)"

exec docker run \
  --detach \
  --rm \
  --volume /etc/fonts:/etc/fonts:ro \
  --volume /etc/localtime:/etc/localtime:ro \
  --volume /tmp/.X11-unix:/tmp/.X11-unix \
  --volume "$dbus_path:$dbus_path" \
  --volume "$HOME/.Xauthority:/home/spotify/.Xauthority:ro" \
  --volume "$HOME/.config/fontconfig:/home/spotify/.config/fontconfig:ro" \
  --volume "$HOME/.config/spotify:/home/spotify/.config/spotify" \
  --volume "$HOME/.cache/spotify:/home/spotify/.cache/spotify" \
  --env DISPLAY \
  --env DBUS_SESSION_BUS_ADDRESS \
  --net host \
  --security-opt seccomp=unconfined \
  --device /dev/snd \
  --device /dev/dri \
  --group-add audio \
  --group-add video \
  --user "$uid:$audio_gid" \
  --name spotify \
  mthssdrbrg/spotify

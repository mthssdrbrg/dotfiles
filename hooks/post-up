#!/usr/bin/env bash

# redirect output to stderr
exec 1>&2

set -e

declare -r rcm_functions="$(readlink -f $(dirname $(readlink -f $0))/../rcm/functions)"

[[ -n "$RC_DEBUG" ]] && set -x
[[ -f "$rcm_functions" ]] && . "$rcm_functions"

if [[ ! -d "$HOME/.vim/bundle/Vundle.vim" ]]; then
  git clone https://github.com/gmarik/Vundle.vim.git $HOME/.vim/bundle/Vundle.vim
  _vim -u $HOME/.vimrc.bundles +PluginInstall +qall
  if [[ -d "$HOME/.vim/bundle/YouCompleteMe" ]]; then
    pushd "$HOME/.vim/bundle/YouCompleteMe"
    ./install.py --clang-completer --gocode-completer
    popd
  fi
fi

if [[ ! -d "$HOME/.zprezto" ]]; then
  git clone --recursive https://github.com/mthssdrbrg/prezto.git "${ZDOTDIR:-$HOME}/.zprezto"
fi

if [[ -d "$HOME/Dropbox/dotfiles/bin" ]]; then
  for path in $HOME/Dropbox/dotfiles/bin/*; do
    dot_bin_path="$HOME/.bin/$(basename "$path")"
    [[ ! -e "$dot_bin_path" ]] && ln -s "$path" "$dot_bin_path"
  done
fi

tag-hook-run "post-up"
